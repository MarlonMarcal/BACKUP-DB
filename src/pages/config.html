<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Configuração</title>
    <!-- evitar ataques de Cross Site Scripting (injeção de dados) -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <link rel="stylesheet" href="config.css">
    
    <script>
        function showTab(tabIndex) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            tabs.forEach((tab, i) => tab.classList.toggle('active', i === tabIndex));
            contents.forEach((content, i) => content.style.display = i === tabIndex ? 'block' : 'none');
        }
        window.onload = function() { showTab(0); };
    </script>
</head>
<body>
    <h2>Configuração</h2>

    <!-- Abas -->
    <div class="tabs">
        <div class="tab active" onclick="showTab(0)">Banco de dados</div>
        <div class="tab" onclick="showTab(1)">Backup</div>
    </div>

    <!-- Aba Banco de Dados -->
    <div class="tab-content" id="db-tab">
        <div class="form-group">
            <label for="host">Host</label>
            <input type="text" id="host" name="host">
        </div>
        <div class="form-group">
            <label for="porta">Porta</label>
            <input type="text" id="porta" name="porta">
        </div>
        <div class="form-group">
            <label for="caminhobanco">Caminho do banco</label>
            <input type="text" id="caminhobanco" name="caminhobanco">
        </div>
        <div class="form-group">
            <label for="usuario">Usuário</label>
            <input type="text" id="usuario" name="usuario">
        </div>
        <div class="form-group">
            <label for="senha">Senha</label>
            <input type="password" id="senha" name="senha">
        </div>
    </div>

    <!-- Aba Backup -->
    <div class="tab-content" id="backup-tab" style="display:none;">
        <div class="form-group">
            <label for="salvar">Salvar em</label>
            <input type="text" id="salvar" name="salvar" placeholder="Informe o caminho para salvar o backup">
            <button id="btn-selecionar" onclick="selecionarDiretorio()">Selecionar...</button>
        </div>
    </div>

    <!-- Rodapé -->
    <div class="footer">
        <button id="btn-salvar">Salvar</button>
        <button id="btn-cancelar" onclick="fechar()">Cancelar</button>
    </div>

    <script src="renderer.js"></script>
    <script>
        const { ipcRenderer } = require('electron');

        document.getElementById('btn-salvar').addEventListener('click', async () => {
            const config = {
                host: document.getElementById('host').value,
                port: document.getElementById('porta').value,
                database: document.getElementById('caminhobanco').value,
                user: document.getElementById('usuario').value,
                password: document.getElementById('senha').value,
                backupPath: document.getElementById('salvar').value                
            };
            await ipcRenderer.invoke('save-config', config);
            alert("Configuração salva! Reinicie o app para aplicar.");
        });

        function selecionarDiretorio() {
            ipcRenderer.invoke('select-directory').then((path) => {
                if (path) {
                    document.getElementById('salvar').value = path;
                }
            });
        }

        function fechar() {
            window.close();
        }

        // Carregar configuração existente
        ipcRenderer.invoke('get-config').then((config) => {
            if (config) {
                document.getElementById('host').value = config.host || '';
                document.getElementById('porta').value = config.port || '';
                document.getElementById('caminhobanco').value = config.database || '';
                document.getElementById('usuario').value = config.user || '';
                document.getElementById('senha').value = config.password || '';
                document.getElementById('salvar').value = config.backupPath || '';                
            }
        });
    </script>
</body>
</html>
